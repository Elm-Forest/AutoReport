<!DOCTYPE html>
<html lang="en">
<head>
    <title>CTGU自动安全上报</title>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">
    <script src="https://unpkg.com/vue@2/dist/vue.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/element-ui/lib/index.js"></script>
    <style>
        #loginBox {
            position: absolute;
            top: 20%;
            left: 37%;
        }

        #login-title {
            text-align: center;
            margin-bottom: 0;
            margin-top: 0;
        }

        #form {
            line-height: 80px;
            padding-left: 30px;
            padding-right: 30px;
            text-align: center;
        }
    </style>
</head>
<body>
<div id="app">
    <div id="loginBox">
        <el-card class="box-card">
            <h2 id="login-title">CTGU自动上报</h2>
            <div style="height: 40px;"></div>
            <el-form id="form" ref="loginFormRef" :model="loginForm">
                <el-form-item prop="name">
                    <el-input prefix-icon="el-icon-user-solid" v-model="loginForm.username" placeholder="学号"
                              clearable></el-input>
                </el-form-item>
                <el-form-item prop="sex">
                    <el-input prefix-icon="el-icon-data-board" v-model="loginForm.password" placeholder="密码"
                              clearable></el-input>
                </el-form-item>
                <el-form-item prop="address">
                    <el-input prefix-icon="el-icon-s-cooperation" v-model="loginForm.email" placeholder="邮箱"
                              clearable></el-input>
                </el-form-item>
                <el-button type="primary" @click="createDept">提交</el-button>
            </el-form>
        </el-card>
    </div>
</div>

</body>
<script>
    Vue.prototype.$axios = axios
    var app = new Vue({
        el: '#app',
        name: 'Login',
        data() {
            return {
                loginForm: {
                    username: '',
                    password: '',
                    email: '',
                }
            }
        }, methods: {
            createDept() {
                const this_vue = this;
                this_vue.$message({
                    message: "您已成功提交信息，正在登录至CTGU安全上报系统，请耐心等待，最多等待30s将返回结果",
                    duration: 8 * 1000,
                    type: 'success'
                });
                this.$axios({
                    method: 'post',
                    url: '/register',
                    data: {
                        'username': this.loginForm.username,
                        'password': this.loginForm.password,
                        'email': this.loginForm.email,
                    }
                }).then(res => {
                    if (!res.data.flag) {
                        this_vue.$message({
                            message: res.data.message,
                            duration: 8 * 1000,
                            type: 'warning'
                        });
                    } else {
                        this_vue.$message({
                            message: "注册成功！每天8点到13点每隔一个小时将尝试自动安全上报",
                            duration: 8 * 1000,
                            type: 'success'
                        });
                    }
                }).catch(e => {
                    this_vue.$message({
                        message: "与服务器连接异常,请检查网络连接或联系服务器管理员，异常信息为：" + e,
                        duration: 8 * 1000,
                        type: 'error'
                    });
                })
            }
        }
    })
</script>
</html>
